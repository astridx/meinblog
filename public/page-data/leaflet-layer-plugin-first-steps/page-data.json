{"componentChunkName":"component---src-templates-post-js","path":"/leaflet-layer-plugin-first-steps/","result":{"data":{"markdownRemark":{"html":"<p>In diesem Beitrag erkläre ich Ihnen, wie Sie ein Plugin für <a href=\"http://leafletjs.com/\">LeafletJs</a> erstellen. Ganz genau zeige ich Ihnen, wie Sie ein Layer-Plugin programmieren. Ein Layer-Plugin ermöglicht es Ihnen, Daten auf der Leaflet-Karte anzuzeigen.</p>\n<p>Sie können zum Beispiel</p>\n<ul>\n<li>Marker,</li>\n<li>geometrische Formen,</li>\n<li>Symbole oder ganz einfach</li>\n<li>Text</li>\n</ul>\n<p>auf der Leaflet-Karte mithilfe von Koordinaten platzieren.</p>\n<p>In diesem Text konzentriere ich mich darauf, die Struktur und den Lebenszyklus von Leaflet-Plugins zu erklären. Meine Vorlage für die Erstellung von Leaflet Control- und Layer-Plugins habe ich auf <a href=\"https://github.com/astridx/leafletjs-plugin-boilerplate\">Github</a> veröffentlicht.</p>\n<h3>Leaflet Layer-Plugins</h3>\n<p>Während <a href=\"/leaflet-control-plugin-first-steps\">Control-Plugin</a>s Leaflet um neue Funktionen erweitern, ermöglichen es Layer-Plugins, neue Arten von Inhalten auf der Karte anzuzeigen. Beispielsweise gibt es Layer-Plugins, um</p>\n<ul>\n<li><a href=\"https://github.com/Leaflet/Leaflet.markercluster\">Marker zu gruppieren</a>,</li>\n<li><a href=\"https://github.com/Leaflet/Leaflet.draw\">Polygone zu zeichnen</a> und</li>\n<li><a href=\"https://github.com/Leaflet/Leaflet.heat\">Daten zu visualisieren</a>.</li>\n</ul>\n<h3>So erstellen Sie ein Leaflet-Layer-Plugin</h3>\n<p>Bevor ich mit Ihnen praktisch einen Layer erstelle, hier die recht langweilig klingende Definition: Layer-Plugins sind JavaScript-Klassen, die die <a href=\"http://leafletjs.com/reference.html#class\">Leaflet Klasse</a> <a href=\"https://leafletjs.com/reference-1.3.4.html#layer\"><code class=\"language-text\">L.Layer</code></a> erweitern. Üblicherweise wird der Name des Layer-Plugins zum Namensraum von Leaflet, also zu <code class=\"language-text\">L</code>, hinzugefügt.</p>\n<p>Im nächsten Beispiel zeige ich Ihnen, wie Sie ein Layer-Plugin mit dem Namen <code class=\"language-text\">L.LeafletLayerExample</code> erstellen. Hier zunächst der JavaScript-Code.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span>LeafletLayerExample <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span>Layer<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Das Standardmuster für die Erstellung eines Leaflet-Plugins, implementiert eine <a href=\"https://de.wikipedia.org/wiki/Fabrikmethode\">Factory-Methode</a>, mit der die Erstellung des Plugins mit anderen Methodenaufrufen verkettet werden kann. Das ist ganz praktisch. Deshalb sollte jedes Leaflet-Plugin diese Factory-Methode enthalten. Schreiben Sie dazu ganz ans Ende der Datei den folgenden Text.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">leafletLayerExample</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">L<span class=\"token punctuation\">.</span>LeafletLayerExample</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nun können sie Ihr Plugin ganz einfach in einer Zeile erstellen und zur Karte hinzufügen – wenn es fertig ist. Im Beispiel würde das wie folgt aussehen:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">leafletLayerExample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addTo</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Auch hier gilt: Üblicherweise wird die Factory-Methode nach der Klasse des Steuerelement-Plugins benannt. Nur der erste Buchstaben wird mit einem kleinen Buchstaben geschrieben, anstelle eines großen.</p>\n<h3>Der Lebenszyklus des Leaflet Layer-Plugins</h3>\n<p>Leaflet ruft die folgenden Methoden eines Layer-Plugins auf, wenn der Layer zu einer Leaflet-Karte hinzugefügt wird.</p>\n<ul>\n<li><code class=\"language-text\">initialize()</code></li>\n<li><code class=\"language-text\">onAdd()</code></li>\n</ul>\n<p>Leaflet ruft die <code class=\"language-text\">initialize</code>-Methode auf, wenn eine neue Instanz eines Layer-Plugins erstellt wird, indem <code class=\"language-text\">new</code> direkt aufgerufen wird oder wenn die Factory-Methode verwendet wird:</p>\n<ul>\n<li><code class=\"language-text\">L.leafletLayerExample()</code></li>\n<li><code class=\"language-text\">new L.LeafletLayerExample()</code></li>\n</ul>\n<p>Ein übliches Layer-Plugin-Muster besteht darin, die Koordinaten des Layers als Schlüssel-Wert-Paar des Optionsparameters zu übergeben. Der Optionsparameter wird dazu an die Initialisierungsmethode übergeben. Durch das Festlegen der Position der Ebene kann das Plugin die Ebene korrekt aktualisieren, wenn die Karte vergrößert, verkleinert oder verschoben wird.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">...</span>\n    <span class=\"token function-variable function\">initialize</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_latLng <span class=\"token operator\">=</span> options<span class=\"token punctuation\">.</span>latLng<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Initialisierung des Layer-Plugins.</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span></code></pre></div>\n<p>Nach dem Setzen des Wertes für <code class=\"language-text\">this._latLng</code> kann der <code class=\"language-text\">initialize</code>-Methode weiterer Code zur Initialisierung des Layers hinzugefügt werden.</p>\n<p>Leaflet ruft die <code class=\"language-text\">onAdd</code>-Methode auf, wenn der Layer mit den folgenden Methodenaufrufen zur Karte hinzugefügt wird:</p>\n<ul>\n<li><code class=\"language-text\">layer.addTo(Karte);</code></li>\n<li><code class=\"language-text\">map.addLayer(Layer);</code></li>\n</ul>\n<p>Bisher war das Erstellen eines Leaflet-Ebenen-Plugins dem Erstellen eines Control-Plugins sehr ähnlich. Der Hauptunterschied zwischen Layer- und Steuerelement-Plugins liegt in der Menge der Arbeit, die die <code class=\"language-text\">onAdd</code>-Methode ausführen muss. Idealerweise erstellt man hier zunächst einen Verweis auf die Karte (<code class=\"language-text\">this._map = map;</code>), um später bei der Verarbeitung von Ereignissen leicht auf diese zugreifen zu können.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">...</span>\n    <span class=\"token function-variable function\">onAdd</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">map</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_map <span class=\"token operator\">=</span> map<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">var</span> layerElementTag <span class=\"token operator\">=</span> <span class=\"token string\">'div'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> layerElementClasses <span class=\"token operator\">=</span> <span class=\"token string\">' leaflet-layer-example leaflet-zoom-hide'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_layerElement <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span>DomUtil<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>layerElementTag<span class=\"token punctuation\">,</span> layerElementClasses<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Continue implementing the layer here.</span>\n\n      map<span class=\"token punctuation\">.</span><span class=\"token function\">getPanes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>overlayPane<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_layerElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      map<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewreset'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_updatePosition<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_updatePosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span></code></pre></div>\n<p>Nachdem der Verweise auf die Karte fertig ist, erstellt die <code class=\"language-text\">onAdd</code>-Methode das DOM-Element, das zur Anzeige der Ebenen-Inhalte genutzt werden soll. (<code class=\"language-text\">var layerElementTag = &#39;div&#39;;</code>).</p>\n<p>Es ist wichtig, die CSS-Klasse <code class=\"language-text\">leaflet-zoom-hide</code> zum Element hinzuzufügen (<code class=\"language-text\">var layerElementClasses = &#39;.my-leaflet-layer leaflet-zoom-hide&#39;;</code>). Elemente der Klasse <code class=\"language-text\">leaflet-zoom-hide</code> werden in Leaflet ausgeblendet, während die Karte vergrößert oder verkleinert wird. Dies bringt Performance-Vorteile.</p>\n<p>Im Gegensatz zu einem Control-Plugin, das mit dem Aufruf von <code class=\"language-text\">map.addControl(Steuerelement)</code> automatisch zur Leaflet-Karte hinzugefügt wird, muss sich ein Layer-Plugin selbst um die Anzeige kümmern (<code class=\"language-text\">map.getPanes().overlayPane.appendChild(this._layerElement);</code>).</p>\n<p>Nachdem Sie es zu einer Leaflet-Karte hinzugefügt haben, muss ein Layer-Plugin das <code class=\"language-text\">viewreset</code>-Ereignis der Leaflet-Karte verfolgen (<code class=\"language-text\">map.on(&#39;viewreset&#39;, this._updatePosition, this);</code>). Leaflet löst ein <code class=\"language-text\">viewreset</code>-Ereignis aus, wenn der Benutzer die Karte vergrößert oder verkleinert. Die Methode <code class=\"language-text\">_updatePosition</code> ist dafür verantwortlich, den Layer neu zu positionieren, wenn die Karte vergrößert oder verkleinert wird.</p>\n<p>Da die Methode <code class=\"language-text\">_updatePosition</code> die Berechnung zum korrekten Positionieren des Layers auf der Karte durchführt, führen wir sie am Ende der <code class=\"language-text\">onAdd()</code>-Methode aus, um dem Layer die korrekte Ausgangsposition zu geben (<code class=\"language-text\">this._updatePosition();</code>).</p>\n<p>Wenn die Karte vergrößert oder verkleinert wird, haben die Breiten- und Längengrade der Ebene (festgelegt, als die Ebene erstellt wurde) unterschiedliche Koordinaten auf dem Bildschirm. Um die Ebene nach einem Zoom neu zu positionieren, berechnet die Methode <code class=\"language-text\">_updatePosition</code> zunächst die Bildschirmkoordinaten der Ebene mit der Methode <code class=\"language-text\">latLngToLayerPoint</code><br>\n(<code class=\"language-text\">var position = this._map.latLngToLayerPoint(this._latLng);</code>) neu. Als Nächstes werden die Bildschirmkoordinaten des DOM-Elements der Ebene mit den neuen Bildschirmkoordinaten (<code class=\"language-text\">L.DomUtil.setPosition(this._layerElement, position);</code>) aktualisiert.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">...</span>\n    <span class=\"token function-variable function\">_updatePosition</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> position <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_map<span class=\"token punctuation\">.</span><span class=\"token function\">latLngToLayerPoint</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_latLng<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span>DomUtil<span class=\"token punctuation\">.</span><span class=\"token function\">setPosition</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_layerElement<span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span></code></pre></div>\n<p>Leaflet ruft eine dritte Layer-Plugin-Methode auf. Diese Methode heißt <code class=\"language-text\">onRemove</code>. Die Methode <code class=\"language-text\">onRemove</code> wird - wie der Name schon sagt - aufgerufen, wenn der Layer aus der Karte entfernt wird.</p>\n<ol>\n<li><code class=\"language-text\">layer.removeFrom</code>(Karte);`</li>\n<li><code class=\"language-text\">map.removeLayer(Layer);</code></li>\n</ol>\n<p>Genau wie die <code class=\"language-text\">onRemove</code>-Methode eines Leaflet-Control-Plugins ist die <code class=\"language-text\">onRemove</code>-Methode eines Layer-Plugins der Ort, an dem aufgeräumt wird. Entfernen Sie hier die DOM-Elemente und Ereignis-Listener. Darüber hinaus sollte sich die Ebene aus dem Overlay-Fensterbereich der Leaflet Karte<br>\nentfernen (<code class=\"language-text\">map.getPanes().overlayPane.removeChild(this._layerElement);</code>) und sie sollte die Überwachung von <code class=\"language-text\">viewreset</code>-Ereignissen (<code class=\"language-text\">map.off(&#39;viewreset&#39;, this._updatePosition, this);</code>) beenden.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">...</span>\n    <span class=\"token function-variable function\">onRemove</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">map</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      map<span class=\"token punctuation\">.</span><span class=\"token function\">getPanes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>overlayPane<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_layerElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      map<span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewreset'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_updatePosition<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span></code></pre></div>\n<h3>Styling</h3>\n<p>Leaflet Layer können Sie wie jedes andere DOM-Element mit CSS gestalten. Hier füge ich der CSS-Klasse <code class=\"language-text\">leaflet-layer-example</code> Stilregeln hinzu. Naja, bisher füge ich nur drei Punkte hinzu. Sie haben sicher etwas mehr Fantasie. Zur Erinnerung: Das <code class=\"language-text\">div</code>-Element mit der Klasse <code class=\"language-text\">leaflet-layer-example</code> haben wir in der <code class=\"language-text\">onAdd</code>-Methode hinzugefügt.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">.</span>leaflet<span class=\"token operator\">-</span>layer<span class=\"token operator\">-</span>example <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span></code></pre></div>\n<h3>Lesen Sie weiter</h3>\n<p>Die Leaflet-Dokumentation enthält einen <a href=\"https://leafletjs.com/2013/06/28/leaflet-plugin-authoring-guide.html\">Plugin-Authoring-Leitfaden</a>, in dem bewährte Vorgehensweisen zum</p>\n<ul>\n<li>Organisieren,</li>\n<li>Präsentieren und</li>\n<li>Demonstrieren</li>\n</ul>\n<p>von Leaflet-Plugin-Code erläutert werden.</p>\n<p>Auf der <a href=\"https://leafletjs.com/plugins.html\">Leaflet Website</a> werden verschiedene Plugins aufgelistet, die von der Leaflet-Community erstellt wurden. Die meisten Plugins sind <a href=\"https://de.wikipedia.org/wiki/Open_Source\">Open Source</a> und sind auf <a href=\"https://github.com/\">GitHub</a> verfügbar. Wer gerne mit Beispielen lernt, findet hier eine Fülle von Möglichkeiten, um das Erstellen eigenes Plugins zu lernen.</p>","excerpt":"In diesem Beitrag erkläre ich Ihnen, wie Sie ein Plugin für LeafletJs erstellen. Ganz genau zeige ich Ihnen, wie Sie ein Layer-Plugin…","fields":{"slug":"/leaflet-layer-plugin-first-steps/"},"frontmatter":{"title":"Erstellen Sie Ihr erstes Leaflet-Layer-Plugin - Ein Tutorial für Anfänger","date":"11.12.2018","tags":["geografische Daten","Leaflet"],"thumbnail":null}}},"pageContext":{"slug":"/leaflet-layer-plugin-first-steps/","previous":{"id":"f4962520-e459-5872-abd2-fc41816ef78c","frontmatter":{"title":"Erstellen Sie Ihr erstes Leaflet-Control-Plugin - Ein Tutorial für Anfänger","tags":["geografische Daten","Leaflet"],"template":"post"},"fields":{"slug":"/leaflet-control-plugin-first-steps/"}},"next":{"id":"6eb6e528-30a3-53ac-8dd4-0f94c08f7282","frontmatter":{"title":"Der Weg zu Joomla 4 Erweiterungen","tags":["CMS","Joomla"],"template":"post"},"fields":{"slug":"/der-weg-zu-joomlae4-erweiterungen/"}}}}}