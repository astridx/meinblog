{"componentChunkName":"component---src-templates-post-js","path":"/leaflet-control-plugin-first-steps/","result":{"data":{"markdownRemark":{"html":"<p>Erstellen Sie Ihr erstes Leaflet-Control-Plugin - Ein Tutorial für Anfänger.</p>\n<p>In diesem Beitrag erkläre ich, wie Sie ein Plugin für LeafletJs erstellen. Ich zeige Ihnen, wie Sie ein Control-Plugin, somit ein Steuerelement für Ihre <a href=\"http://leafletjs.com/\">Leaflet</a> Karte programmieren.</p>\n<p>In diesem Text konzentriere ich mich darauf, die Struktur und den Lebenszyklus von Leaflet-Plugins zu erklären. Meine Codebeispiel habe ich auf <a href=\"https://github.com/astridx/leafletjs-plugin-boilerplate\">Github</a> veröffentlicht.</p>\n<h2>Leaflet Control-Plugins</h2>\n<p>Während <a href=\"/leaflet-layer-plugin-first-steps\">Layer-Plugins</a> die Karte mit Inhalten erweitern, fügen Control-Plugins Steuerelemente hinzu. Mithilfe dieser Elemente interagieren Sie mit der Karte. Beispiele für Steuerelemente sind die</p>\n<ul>\n<li>Zoomsteuerung und die</li>\n<li>Ebenensteuerung,</li>\n</ul>\n<p>die links oben und rechts oben in der folgenden Abbildung angezeigt werden.</p>\n<p><img src=\"/images/leafletcontrollsundlayer.png\"></p>\n<h2>So erstellen Sie ein Leaflet Control-Plugin</h2>\n<p>Bevor ich mit Ihnen praktisch ein Control erstelle, hier die recht langweilig klingende Definition: Control-Plugins sind JavaScript-Klassen, die die Leaflet <a href=\"https://leafletjs.com/reference-1.6.0.html#class\">Klasse</a> <a href=\"https://leafletjs.com/reference-1.3.4.html#control\"><code class=\"language-text\">L.Control</code></a> erweitern. Üblicherweise wird der Name des Plugins zum Namensraum von Leaflet, zu <code class=\"language-text\">L</code>, hinzugefügt.</p>\n<p>Im nächsten Beispiel zeige ich Ihnen, wie Sie ein Control-Plugin mit dem Namen <code class=\"language-text\">L.LeafletControlExample</code> erstellen. Hier zunächst der JavaScript Code.</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">LeafletControlExample</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">Control</span><span class=\"mtk1\">.</span><span class=\"mtk7\">extend</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  options: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    position: ‚</span><span class=\"mtk7\">topright</span><span class=\"mtk1\">‘</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk8\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Die Erweiterungsmethode <code class=\"language-text\">extend</code> der Klasse <code class=\"language-text\">L.Control</code> verwendet einen einzigen Parameter, der alle Eigenschaften und Methoden enthält, die das Plugin der <code class=\"language-text\">L.Control</code>-Unterklasse hinzufügt. Viele Control-Plugins verfügen über eine Reihe von Standardeinstellungen. Im obigen Code-Schnipsel enthält das Objekt <code class=\"language-text\">options</code> eine Standardeinstellung für die Position <code class=\"language-text\">position</code> des Steuerelements auf der Karte.</p>\n<p>Das Standardmuster für die Erstellung eines Leaflet-Plugins, implementiert eine <a href=\"https://de.wikipedia.org/wiki/Fabrikmethode\">Factory-Methode</a>, mit der die Erstellung des Plugins mit anderen Methoden-Aufrufen verkettet wird. Das ist praktisch. Deshalb enthält jedes Plugin diese Factory-Methode. Schreiben Sie dazu ans Ende der Datei den folgenden Text.</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">leafletControlExample</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk13 mtkb\">function</span><span class=\"mtk1\"> (options) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk8\">return</span><span class=\"mtk1\"> </span><span class=\"mtk8\">new</span><span class=\"mtk1\"> </span><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">LeafletControlExample</span><span class=\"mtk1\">(</span><span class=\"mtk7\">options</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Erstellen Sie Ihr Plugin in einer Zeile und fügen es zur Karte hinzu. Im Beispiel würde das wie folgt aussehen:</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">leafletControlExample</span><span class=\"mtk1\">({ position: ‚</span><span class=\"mtk7\">bottomright</span><span class=\"mtk1\">‘ }).</span><span class=\"mtk7\">addTo</span><span class=\"mtk1\">(</span><span class=\"mtk7\">map</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>Üblicherweise wird die Factory-Methode nach der Klasse des Steuerelement-Plugins benannt. Nur der erste Buchstabe wird - anstelle eines große - mit einem kleinen geschrieben.</p>\n<h3>Der Lebenszyklus des Leaflet Controll-Plugins</h3>\n<p>Leaflet ruft die folgenden Methoden eines Steuerelement-Plugins auf, wenn das Element zu einer Karte hinzugefügt wird.</p>\n<ul>\n<li>initialize()</li>\n<li>onAdd ()</li>\n</ul>\n<p>Leaflet ruft die initialize-Methode auf, wenn eine neue Instanz eines Controll-Plugins erstellt wird, indem entweder new direkt aufgerufen wird oder wenn die Factory-Methode verwendet wird:</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">leafletControlExample</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">new</span><span class=\"mtk1\"> </span><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">LeafletControlExample</span><span class=\"mtk1\">()</span></span></span></code></pre>\n<p>In der folgenden <code class=\"language-text\">initialize</code>-Methode wird <code class=\"language-text\">L.Util.setOptions</code> aufgerufen, um die Werte der Standardeinstellungen zu setzten.</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">initialize: </span><span class=\"mtk13 mtkb\">function</span><span class=\"mtk1\">(options) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">Util</span><span class=\"mtk1\">.</span><span class=\"mtk7\">setOptions</span><span class=\"mtk1\">(</span><span class=\"mtk7\">this</span><span class=\"mtk1\">, </span><span class=\"mtk7\">options</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3 mtki\">// Initialisierung des Control-Plugins.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span></code></pre>\n<p>Nach dem Aufruf von setOptions fügen wir der <code class=\"language-text\">initialize</code>-Methode weiteren Code zur Initialisierung des Steuerelements hinzu.</p>\n<p>Leaflet ruft die <code class=\"language-text\">onAdd</code>-Methode auf, wenn das Steuerelement mit einem der folgenden Methodenaufrufe zur Karte hinzugefügt wird:</p>\n<ul>\n<li>control.addTo(Karte);</li>\n<li>map.addControl(Steuerelement);</li>\n</ul>\n<p>Ein Leaflet-Control-Plugins ist ein DOM-Element Element - in der Regel ein HTML-Element -, das auf der Karte angezeigt wird. Genauer ausgedrückt: Das Element wird auf einer Schicht oberhalb der eigentlichen Kartenschicht angezeigt.</p>\n<p><strong>Wichtig:</strong> Die onAdd-Methode muss das DOM-Element zurückgeben.</p>\n<p>In der folgenden <code class=\"language-text\">onAdd</code>-Methode erstellen wir ein div-Element. Diesem <code class=\"language-text\">div</code>-Element fügen wir danach die Klasse <code class=\"language-text\">leaflet-control-example</code> hinzu. So formatieren wir das Steuerelement später mit CSS problemlos.</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">onAdd: </span><span class=\"mtk13 mtkb\">function</span><span class=\"mtk1\">(map) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk13 mtkb\">var</span><span class=\"mtk1\"> </span><span class=\"mtk7\">controlElementTag</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> ‚</span><span class=\"mtk7\">div</span><span class=\"mtk1\">‘;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk13 mtkb\">var</span><span class=\"mtk1\"> </span><span class=\"mtk7\">controlElementClass</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> ‚</span><span class=\"mtk7\">leaflet</span><span class=\"mtk8\">-</span><span class=\"mtk7\">control</span><span class=\"mtk8\">-</span><span class=\"mtk7\">example</span><span class=\"mtk1\">‘;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk13 mtkb\">var</span><span class=\"mtk1\"> </span><span class=\"mtk7\">controlElement</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">L</span><span class=\"mtk1\">.</span><span class=\"mtk7\">DomUtil</span><span class=\"mtk1\">.</span><span class=\"mtk7\">create</span><span class=\"mtk1\">(</span><span class=\"mtk7\">controlElementTag</span><span class=\"mtk1\">, </span><span class=\"mtk7\">controlElementClass</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3 mtki\">// Hier können noch weitere Elemente hinzugefügt werden.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3 mtki\">// Außerdem können Sie hier einem Element Events hinzufügen.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk8\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">controlElement</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span></code></pre>\n<p>Wenn alles fertig ist, geben Sie das DOM-Element mit return controlElement zurück.</p>\n<p>Leaflet erwartet eine weitere Methode. Diese heißt <code class=\"language-text\">onRemove</code>. <code class=\"language-text\">onRemove</code> wird - wie der Name schon sagt - aufgerufen, wenn das Steuerelement von der Karte entfernt wird.</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">control</span><span class=\"mtk1\">.</span><span class=\"mtk7\">removeFrom</span><span class=\"mtk1\">(</span><span class=\"mtk7\">Karte</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">map</span><span class=\"mtk1\">.</span><span class=\"mtk7\">removeControl</span><span class=\"mtk1\">(</span><span class=\"mtk7\">Steuerelement</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Die onRemove-Methode ist der Ort, an dem aufgeräumt wird. Entfernen Sie hier die DOM-Elemente und Ereignis-Listener.</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">onRemove: </span><span class=\"mtk13 mtkb\">function</span><span class=\"mtk1\">(map) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3 mtki\">// Tear down the control.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span></code></pre>\n<h3>Styling</h3>\n<p>Gestalten Sie Leaflet Steuerelemente wie jedes andere DOM-Element mit CSS. Hier füge ich der CSS-Klasse leaflet-control-example Stilregeln hinzu. Naja, bisher stehen hier drei Punkte. Sie haben sicher etwas mehr Fantasie. Zur Erinnerung: Das div-Element mit der Klasse leaflet-control-example haben wir in der onAdd-Methode hinzugefügt.</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">.</span><span class=\"mtk7\">leaflet</span><span class=\"mtk8\">-</span><span class=\"mtk7\">control</span><span class=\"mtk8\">-</span><span class=\"mtk7\">example</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk8\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">...</span></span></span></code></pre>\n<h3>Lesen Sie weiter</h3>\n<p>Die Leaflet-Dokumentation enthält einen <a href=\"https://leafletjs.com/2013/06/28/leaflet-plugin-authoring-guide.html\">Plugin-Authoring-Leitfaden</a>, in dem bewährte Vorgehensweisen zum</p>\n<ul>\n<li>Organisieren,</li>\n<li>Präsentieren und</li>\n<li>Demonstrieren</li>\n</ul>\n<p>von Leaflet-Plugin-Code erläutert werden.</p>\n<p>Auf der <a href=\"https://leafletjs.com/plugins.html\">Leaflet Website</a> werden verschiedene Plugins aufgelistet, die von der Leaflet-Community erstellt wurden. Die meisten Plugins sind <a href=\"https://de.wikipedia.org/wiki/Open_Source\">Open Source</a> und sind auf <a href=\"https://github.com/\">GitHub</a> verfügbar. Wer gerne mit Beispielen lernt, findet hier eine Fülle von Möglichkeiten, um das Erstellen eigenes Plugins zu lernen.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .solarized-light { background-color: #FDF6E3; }\n  .solarized-light .mtki { font-style: italic; }\n  .solarized-light .mtkb { font-weight: bold; }\n  .solarized-light .mtk7 { color: #268BD2; }\n  .solarized-light .mtk1 { color: #657B83; }\n  .solarized-light .mtk8 { color: #859900; }\n  .solarized-light .mtk13 { color: #073642; }\n  .solarized-light .mtk3 { color: #93A1A1; }\n  .solarized-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n</style>","excerpt":"Erstellen Sie Ihr erstes Leaflet-Control-Plugin - Ein Tutorial für Anfänger. In diesem Beitrag erkläre ich, wie Sie ein Plugin für LeafletJs…","fields":{"slug":"/leaflet-control-plugin-first-steps/"},"frontmatter":{"title":"Erstellen Sie Ihr erstes Leaflet-Control-Plugin - Ein Tutorial für Anfänger","date":"10.12.2018","tags":["geografische Daten","Leaflet"],"thumbnail":null}}},"pageContext":{"slug":"/leaflet-control-plugin-first-steps/","previous":{"id":"58da73b6-3ef0-5940-86a9-269dfc44b65c","frontmatter":{"title":"Leaflet","tags":["geografische Daten","Leaflet"],"template":"post"},"fields":{"slug":"/leaflet-tutorials/"}},"next":{"id":"9553a817-841f-5db4-ab3a-f4dd1cf852f2","frontmatter":{"title":"Erstellen Sie Ihr erstes Leaflet-Layer-Plugin - Ein Tutorial für Anfänger","tags":["geografische Daten","Leaflet"],"template":"post"},"fields":{"slug":"/leaflet-layer-plugin-first-steps/"}}}}}